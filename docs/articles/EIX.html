<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EIX: Explain Interactions in XGBoost â€¢ EIX</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top navbar-mi2" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-mi2logo" href="http://mi2.mini.pw.edu.pl/">
        <img src="https://github.com/mi2-warsaw/MI2template/blob/master/inst/pkgdown/assets/MI2logo.jpg?raw=true" alt="MI2" height="46" title="MI2"></a>
      <a class="navbar-brand navbar-mi2" href="../index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="navbar-mi2 nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/EIX.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>EIX: Explain Interactions in XGBoost</h1>
                        <h4 class="author">Ewelina Karbowiak</h4>
            
            <h4 class="date">2018-12-07</h4>
      
      
      <div class="hidden name"><code>EIX.Rmd</code></div>

    </div>

    
    
<p>Package <code>EIX</code> is the set of tools to explore the structure of XGBoost and lightGBM models. It includes functions finding strong interactions and also checking importance of single variables and interactions by usage different measures. <code>EIX</code> consists several functions to visualize results.</p>
<p>Almost all <code>EIX</code> functions require only two parameters: a XGBoost or LightGBM model and data table used as training dataset. The exceptions are the <code>waterfall</code> function and its plot. The first one requires parameters: a XGBoost model and observation, which prediction has to be explained). These two functions support only XGBoost models. All plots are created with package <code>ggplot2</code>. Most of them use plot theme <code>theme_mi2</code> from <code>DALEX</code>.</p>
<div id="data-info" class="section level2">
<h2 class="hasAnchor">
<a href="#data-info" class="anchor"></a>Data Info</h2>
<p>This vignette shows usage of <code>EIX</code> package. It lets to explain XGBoost prediction model concerning departures of employees from company using HR_data. Dataset was taken from <a href="https://www.kaggle.com/ludobenistant/hr-analytics">kaggle</a> and consists 14999 observations and 10 variables. The dataset is also available in package <code>EIX</code> and there it is described more precisely.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">4</span>)
data&lt;-HR_data
knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(data))</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">satisfaction_level</th>
<th align="right">last_evaluation</th>
<th align="right">number_project</th>
<th align="right">average_montly_hours</th>
<th align="right">time_spend_company</th>
<th align="right">Work_accident</th>
<th align="right">left</th>
<th align="right">promotion_last_5years</th>
<th align="left">sales</th>
<th align="left">salary</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.38</td>
<td align="right">0.53</td>
<td align="right">2</td>
<td align="right">157</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">sales</td>
<td align="left">low</td>
</tr>
<tr class="even">
<td align="right">0.80</td>
<td align="right">0.86</td>
<td align="right">5</td>
<td align="right">262</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">sales</td>
<td align="left">medium</td>
</tr>
<tr class="odd">
<td align="right">0.11</td>
<td align="right">0.88</td>
<td align="right">7</td>
<td align="right">272</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">sales</td>
<td align="left">medium</td>
</tr>
<tr class="even">
<td align="right">0.72</td>
<td align="right">0.87</td>
<td align="right">5</td>
<td align="right">223</td>
<td align="right">5</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">sales</td>
<td align="left">low</td>
</tr>
<tr class="odd">
<td align="right">0.37</td>
<td align="right">0.52</td>
<td align="right">2</td>
<td align="right">159</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">sales</td>
<td align="left">low</td>
</tr>
<tr class="even">
<td align="right">0.41</td>
<td align="right">0.50</td>
<td align="right">2</td>
<td align="right">153</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">sales</td>
<td align="left">low</td>
</tr>
</tbody>
</table>
<p>To create correct XGBoost model, remember to change categorical features to factors and next change the data frame to sparse matrix. The categorical features are one-hot encoded.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"Matrix"</span>)
sparse_matrix &lt;-<span class="st"> </span><span class="kw">sparse.model.matrix</span>(left <span class="op">~</span><span class="st"> </span>. <span class="op">-</span><span class="st"> </span><span class="dv">1</span>,  <span class="dt">data =</span> HR_data)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(sparse_matrix)</code></pre></div>
<pre><code>## 6 x 19 sparse Matrix of class "dgCMatrix"
##                                                
## 1 0.38 0.53 2 157 3 . . . . . . . . . 1 . . 1 .
## 2 0.80 0.86 5 262 6 . . . . . . . . . 1 . . . 1
## 3 0.11 0.88 7 272 4 . . . . . . . . . 1 . . . 1
## 4 0.72 0.87 5 223 5 . . . . . . . . . 1 . . 1 .
## 5 0.37 0.52 2 159 3 . . . . . . . . . 1 . . 1 .
## 6 0.41 0.50 2 153 3 . . . . . . . . . 1 . . 1 .</code></pre>
</div>
<div id="xgboost-model-creation" class="section level2">
<h2 class="hasAnchor">
<a href="#xgboost-model-creation" class="anchor"></a>Xgboost model creation</h2>
<p>Package <code>EIX</code> uses table, which was generated by <code><a href="https://www.rdocumentation.org/packages/xgboost/topics/xgb.model.dt.tree">xgboost::xgb.model.dt.tree</a></code> with information about trees, their nodes and leaves.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"xgboost"</span>)
param &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">objective =</span> <span class="st">"binary:logistic"</span>, <span class="dt">max_depth =</span> <span class="dv">2</span>)
xgb_model &lt;-<span class="st"> </span><span class="kw">xgboost</span>(sparse_matrix, <span class="dt">params =</span> param, <span class="dt">label =</span> HR_data[, left] <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">nrounds =</span> <span class="dv">50</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)
knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(xgboost<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/xgboost/topics/xgb.model.dt.tree">xgb.model.dt.tree</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(sparse_matrix),xgb_model)))</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Tree</th>
<th align="right">Node</th>
<th align="left">ID</th>
<th align="left">Feature</th>
<th align="right">Split</th>
<th align="left">Yes</th>
<th align="left">No</th>
<th align="left">Missing</th>
<th align="right">Quality</th>
<th align="right">Cover</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">0</td>
<td align="left">0-0</td>
<td align="left">satisfaction_level</td>
<td align="right">0.465</td>
<td align="left">0-1</td>
<td align="left">0-2</td>
<td align="left">0-1</td>
<td align="right">3123.2509800</td>
<td align="right">3749.75</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
<td align="left">0-1</td>
<td align="left">number_project</td>
<td align="right">2.500</td>
<td align="left">0-3</td>
<td align="left">0-4</td>
<td align="left">0-3</td>
<td align="right">892.9471440</td>
<td align="right">1045.75</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">2</td>
<td align="left">0-2</td>
<td align="left">time_spend_company</td>
<td align="right">4.500</td>
<td align="left">0-5</td>
<td align="left">0-6</td>
<td align="left">0-5</td>
<td align="right">1284.8271500</td>
<td align="right">2704.00</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">3</td>
<td align="left">0-3</td>
<td align="left">Leaf</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">0.4536083</td>
<td align="right">435.50</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">4</td>
<td align="left">0-4</td>
<td align="left">Leaf</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">-0.1082209</td>
<td align="right">610.25</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">5</td>
<td align="left">0-5</td>
<td align="left">Leaf</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">-0.5823490</td>
<td align="right">2208.50</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># library("lightgbm")</span>
<span class="co"># </span>
<span class="co"># lgb.train.data &lt;- lgb.Dataset(sparse_matrix, label = label)</span>
<span class="co"># lgb.params = list(objective = "binary",max_depth=4)</span>
<span class="co"># </span>
<span class="co"># lgb.model &lt;- lgb.train(lgb.params, lgb.train.data, 100)</span>
<span class="co"># library(lightgbm)</span>
<span class="co"># </span>
<span class="co"># lgb.train.data &lt;- lgb.Dataset(sparse_matrix, label = label)</span>
<span class="co"># lgb.params = list(objective = "binary",max_depth=2)</span>
<span class="co"># </span>
<span class="co"># xgb_model &lt;- lgb.train(lgb.params, lgb.train.data, 100)</span></code></pre></div>
<p>Function <code><a href="https://www.rdocumentation.org/packages/xgboost/topics/xgb.importance">xgboost::xgb.importance</a></code> shows importance of single variables. <code>EIX</code> adds new measures of variablesâ€™ importance and shows also importance of interactions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(xgboost<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/xgboost/topics/xgb.importance">xgb.importance</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(sparse_matrix),xgb_model)))</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Feature</th>
<th align="right">Gain</th>
<th align="right">Cover</th>
<th align="right">Frequency</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">satisfaction_level</td>
<td align="right">0.4397899</td>
<td align="right">0.3478570</td>
<td align="right">0.3233083</td>
</tr>
<tr class="even">
<td align="left">time_spend_company</td>
<td align="right">0.2227345</td>
<td align="right">0.1788187</td>
<td align="right">0.1654135</td>
</tr>
<tr class="odd">
<td align="left">number_project</td>
<td align="right">0.1771743</td>
<td align="right">0.1233794</td>
<td align="right">0.1353383</td>
</tr>
<tr class="even">
<td align="left">average_montly_hours</td>
<td align="right">0.0725184</td>
<td align="right">0.1498953</td>
<td align="right">0.1654135</td>
</tr>
<tr class="odd">
<td align="left">last_evaluation</td>
<td align="right">0.0707292</td>
<td align="right">0.1411911</td>
<td align="right">0.1428571</td>
</tr>
<tr class="even">
<td align="left">Work_accident</td>
<td align="right">0.0093155</td>
<td align="right">0.0290993</td>
<td align="right">0.0300752</td>
</tr>
</tbody>
</table>
</div>
<div id="model-visualization" class="section level2">
<h2 class="hasAnchor">
<a href="#model-visualization" class="anchor"></a>Model visualization</h2>
<p>The <code>lollipop</code> plot is used to visualize the model in such way that the most important variables and interactions are visible.</p>
<p>On the x-axis, there are tree numbers and on the y-axis there is <strong>Gain</strong> measure for each node. One segment is one tree in the model and each point is one node. On the plot there are all nodes, which are not leaves. Shape of points signifies depth of node. All roots on the plot are connected by a red line. If in the same segment there is a variable with a higher depth above the variable with a lower depth, it means that interaction occurs.</p>
<p>There is opportunity to set a different way of labeling. On the plot we can see the most important variables in roots (horizontal labels), and interactions (vertical labels), this is option <code>label="topAll"</code> which is default. Moreover, there are two additional options: <code>labels="roots"</code> - for variables in roots only, <code>labels="interactions"</code> for interactions only. The plot is on a logarithmic scale because the initial trees usually are the most important. You can change the scale of the plot by setting the parameter <code>log=FALSE</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lolli&lt;-<span class="kw"><a href="../reference/lollipop.html">lollipop</a></span>(xgb_model,sparse_matrix)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(lolli)</code></pre></div>
<p><img src="EIX_files/figure-html/unnamed-chunk-6-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#plot(lolli, labels="roots")</span>
<span class="co">#plot(lolli, labels="interactions")</span>
<span class="co">#plot(lolli, log=FALSE)</span></code></pre></div>
</div>
<div id="interactions" class="section level2">
<h2 class="hasAnchor">
<a href="#interactions" class="anchor"></a>Interactions</h2>
<p>We can consider interactions in two ways. In first approach we can explore all pairs of variable, which occur in the model one above the other. This approach is not the best one, because we cannot distinguish if pair of variables are real interaction or not. In this approach high gain of pair can be a result of high gain of down variable (child). To explore pairs of variables you can generate table with them using function <code>interactions</code> with parametr <code>option="pairs"</code>. This table includes <strong>Gain</strong> measure and number of occurrences of pairs. You can also use the function <code>plot</code> to visualize <strong>Gain</strong> measure.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pairs&lt;-<span class="kw"><a href="../reference/interactions.html">interactions</a></span>(xgb_model, sparse_matrix, <span class="dt">option =</span> <span class="st">"pairs"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(pairs)</code></pre></div>
<pre><code>##                Parent                Child   sumGain frequency
## 1: satisfaction_level       number_project 3573.8695         6
## 2: satisfaction_level   time_spend_company 3421.1675         5
## 3: satisfaction_level   satisfaction_level 1078.1480        10
## 4:    last_evaluation average_montly_hours  843.8720         4
## 5:    last_evaluation   satisfaction_level  826.7479         6
## 6:    last_evaluation   time_spend_company  651.9038         4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(pairs)</code></pre></div>
<p><img src="EIX_files/figure-html/unnamed-chunk-7-1.png" width="576" style="display: block; margin: auto;"></p>
<p>The <code>interactions</code> plot is a matrix plot with a child from the pair on the x-axis and the parent on the y-axis. The color of the square at the intersection of two variables means value of <strong>sumGain</strong> measure. The darker square, the higher <strong>sumGain</strong> of variable pairs. The range of <strong>sumGain</strong> measure is divided into four equal parts: <code>very low, low, medium, high</code>.</p>
<p>In second approach, to find strong interactions, we can consider only these pairs of variables, where variable on the bottom (child) has higher gain than variable on the top (parent). We can also create ranking of interactions using function <code>importance</code> with parameter <code>option="interactions"</code>. More details in the next section.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">interactions&lt;-<span class="kw"><a href="../reference/interactions.html">interactions</a></span>(xgb_model, sparse_matrix, <span class="dt">option =</span> <span class="st">"interactions"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(interactions)</code></pre></div>
<pre><code>##                  Parent                Child  sumGain frequency
## 1:      last_evaluation average_montly_hours 745.5943         2
## 2:      last_evaluation   satisfaction_level 708.8723         4
## 3:      last_evaluation   time_spend_company 634.9984         3
## 4:   satisfaction_level   time_spend_company 559.9985         2
## 5:      last_evaluation       number_project 390.1898         1
## 6: average_montly_hours   time_spend_company 318.0142         2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(interactions)</code></pre></div>
<p><img src="EIX_files/figure-html/unnamed-chunk-8-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="variables-and-interactions-importance" class="section level2">
<h2 class="hasAnchor">
<a href="#variables-and-interactions-importance" class="anchor"></a>Variablesâ€™ and interactionsâ€™ importance</h2>
<p>For exploring variablesâ€™ and interactionsâ€™ importance there are three functions in <code>EIX</code> package: <code>importance</code>, its <code>plot</code> with parameter <code>radar = TRUE</code> or <code>radar = FALSE</code>. With <code>EIX</code> package we can compare importance of single variables and interactions. The functions <code>importance</code> can return three kinds of outputs, depending on the <code>opt</code> parameter:</p>
<ul>
<li><p><code>option = "variables"</code> - it consists only single variables</p></li>
<li><p><code>option = "interactions"</code>- only interactions</p></li>
<li><p><code>option = "both"</code>- output shows importance both single variables and interactions.</p></li>
</ul>
<p>NOTE: <code>option = "both"</code> is not direct connection <code>option = "variables"</code> and <code>option = "interactions"</code>, because values of variable importance measure, which were in the interactions, are not included in importance of single variable.</p>
<p>In <code>EIX</code> the following measures are available:</p>
<ul>
<li>
<strong>sumGain</strong> - sum of Gain value in all nodes, in which given variable occurs</li>
<li>
<strong>sumCover</strong> - sum of Cover value in all nodes, in which given variable occurs; for LightGBM models: number of observation, which pass through the node</li>
<li>
<strong>mean5Gain</strong> - mean gain from 5 occurrences of given variable with the highest gain</li>
<li>
<strong>meanGain</strong> - mean Gain value in all nodes, in which given variable occurs</li>
<li>
<strong>meanCover</strong> - mean Cover value in all nodes, in which given variable occurs; for LightGBM models: mean number of observation, which pass through the node</li>
<li>
<strong>freqency</strong> - number of occurrences in the nodes for given variable</li>
</ul>
<p><code>EIX</code> package gives additionally measures of variables importance for single variable:</p>
<ul>
<li>
<strong>counterRoot</strong> - number of occurrences in the root</li>
<li>
<strong>weightedRoot</strong> - mean number of occurrences in the root, which is weighted by gain</li>
<li>
<strong>meanDepth </strong> - mean depth weighted by gain</li>
</ul>
<p>The function <code>importance</code> returns a table with all available importance measures for given option. The table is sorted by descending value of <strong>sumGain</strong>.</p>
<p>The function <code>plot</code> with parameter <code>radar = FALSE</code> and a result from the <code>importance</code> function as an argument shows two measures of importance, which can be chosen by <code>xmeasure</code> and <code>ymeasure</code> parameters. By parameter <code>top</code> we can decide how many positions will be included in the plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">importance&lt;-<span class="kw"><a href="../reference/importance.html">importance</a></span>(xgb_model, sparse_matrix, <span class="dt">option =</span> <span class="st">"both"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(importance)</code></pre></div>
<pre><code>##                                 Feature sumGain sumCover meanGain
## 1:                   satisfaction_level 10040.0    43920   264.10
## 2:                   time_spend_company  4016.0    19820   267.70
## 3:                       number_project  3706.0    13940   264.70
## 4:                      last_evaluation  1181.0    15340    90.81
## 5:                 average_montly_hours   886.0    18190    46.63
## 6: last_evaluation:average_montly_hours   745.6     1767   372.80
##    meanCover frequency mean5Gain
## 1:    1156.0        38    1513.0
## 2:    1321.0        15     670.4
## 3:     995.6        14     697.4
## 4:    1180.0        13     183.0
## 5:     957.6        19      97.5
## 6:     883.7         2     372.8</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(importance, <span class="dt">radar=</span><span class="ot">FALSE</span>)</code></pre></div>
<p><img src="EIX_files/figure-html/unnamed-chunk-9-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#plot(importance,  xmeasure = "mean5Gain", ymeasure = "sumGain",  top = 15, radar=FALSE)</span></code></pre></div>
<p>The function <code>plot</code> with parameter <code>radar = TRUE</code> enables to compare different measures of variables and interactions importance on the radar plot from <code>ggiraphExtra</code> package. Bellow I attach the example of radar plot. On the outside of the circle there are names of variables or interactions. Colored lines represent various measures of importance. The positions on the plot are sorted decreasing. The variable with the highest <strong>sumGain</strong> value is on the right of 12 oâ€™clock. Next the <strong>sumGain</strong> value decreases in a clockwise direction.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(importance)</code></pre></div>
<p><img src="EIX_files/figure-html/unnamed-chunk-10-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#plot(importance, top=15)</span></code></pre></div>
</div>
<div id="explanation-of-single-prediction-including-interactions" class="section level2">
<h2 class="hasAnchor">
<a href="#explanation-of-single-prediction-including-interactions" class="anchor"></a>Explanation of single prediction including interactions</h2>
<p>For single prediction explaining package <code>EIX</code> uses two packages: <code>xgboostExplainer</code> i <code>breakDown</code>. The package <code>xgboostExplainer</code> is a tool to interpreting prediction of xgboost model. The package <code>EIX</code> uses its code and modifies it to include interactions. The methodology of plot creation comes from package <code>breakDown</code>.</p>
<p>The function <code>waterfall</code> returns table with variablesâ€™ impact on the prediction of the model. Depending on the parameter <code>option</code>, the table includes interactions (<code>option="interactions"</code>- default) or does not (<code>option="variables"</code>). The function <code>plot</code> with <code>waterfall</code> object as an argument visualizes this table. On the y-axis there are: intercept (it is the probability that random variable from training dataset will be 1), variables (which have an impact on prediction) and final prognosis of the model. On the x-axis there is log-odds of impact each variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_observation &lt;-<span class="st"> </span>sparse_matrix[<span class="dv">9</span>,]
wf&lt;-<span class="kw"><a href="../reference/waterfall.html">waterfall</a></span>(xgb_model, new_observation, <span class="dt">option =</span> <span class="st">"interactions"</span>)
wf</code></pre></div>
<pre><code>##                                                 contribution
## (Intercept)                                           -1.530
## time_spend_company = 5                                 1.519
## last_evaluation = 1                                    1.485
## Work_accident = 0                                     -0.736
## satisfaction_level:time_spend_company = 0.89:5         0.406
## last_evaluation:time_spend_company = 1:5               0.316
## number_project:last_evaluation = 5:1                   0.258
## satisfaction_level = 0.89                             -0.238
## last_evaluation:average_montly_hours = 1:224           0.227
## number_project = 5                                    -0.224
## salarylow = 1                                          0.166
## average_montly_hours:last_evaluation = 224:1          -0.156
## last_evaluation:satisfaction_level = 1:0.89            0.111
## average_montly_hours:time_spend_company = 224:5        0.098
## time_spend_company:last_evaluation = 5:1               0.095
## average_montly_hours:number_project = 224:5            0.094
## average_montly_hours = 224                            -0.048
## satisfaction_level:number_project = 0.89:5            -0.003
## final_prognosis                                        1.839
## baseline:  0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(wf)</code></pre></div>
<p><img src="EIX_files/figure-html/unnamed-chunk-11-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#wf&lt;-waterfall(xgb_model, new_observation, option = "interactions", baseline = "intercept")</span>
<span class="co">#wf</span>
<span class="co">#plot(wf)</span>
<span class="co">#wf&lt;-waterfall(xgb_model, new_observation, option = "interactions")</span>
<span class="co">#wf</span>
<span class="co">#plot(wf, trans = function(x) exp(x)/(1+exp(x)))</span>
wf&lt;-<span class="kw"><a href="../reference/waterfall.html">waterfall</a></span>(xgb_model, new_observation, <span class="dt">option =</span> <span class="st">"interactions"</span>, <span class="dt">baseline =</span> <span class="st">"intercept"</span>)
wf</code></pre></div>
<pre><code>##                                                 contribution
## time_spend_company = 5                                 1.519
## last_evaluation = 1                                    1.485
## Work_accident = 0                                     -0.736
## satisfaction_level:time_spend_company = 0.89:5         0.406
## last_evaluation:time_spend_company = 1:5               0.316
## number_project:last_evaluation = 5:1                   0.258
## satisfaction_level = 0.89                             -0.238
## last_evaluation:average_montly_hours = 1:224           0.227
## number_project = 5                                    -0.224
## salarylow = 1                                          0.166
## average_montly_hours:last_evaluation = 224:1          -0.156
## last_evaluation:satisfaction_level = 1:0.89            0.111
## average_montly_hours:time_spend_company = 224:5        0.098
## time_spend_company:last_evaluation = 5:1               0.095
## average_montly_hours:number_project = 224:5            0.094
## average_montly_hours = 224                            -0.048
## satisfaction_level:number_project = 0.89:5            -0.003
## final_prognosis                                        3.369
## baseline:  -1.530202</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(wf, <span class="dt">trans =</span> <span class="cf">function</span>(x) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(x)<span class="op">/</span>(<span class="dv">1</span><span class="op">+</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(x)))</code></pre></div>
<p><img src="EIX_files/figure-html/unnamed-chunk-11-2.png" width="576" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#data-info">Data Info</a></li>
      <li><a href="#xgboost-model-creation">Xgboost model creation</a></li>
      <li><a href="#model-visualization">Model visualization</a></li>
      <li><a href="#interactions">Interactions</a></li>
      <li><a href="#variables-and-interactions-importance">Variablesâ€™ and interactionsâ€™ importance</a></li>
      <li><a href="#explanation-of-single-prediction-including-interactions">Explanation of single prediction including interactions</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Ewelina Karbowiak, Przemyslaw Biecek.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
