<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EIX: Titanic data • EIX</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top navbar-mi2" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-mi2logo" href="http://mi2.mini.pw.edu.pl/">
        <img src="https://github.com/mi2-warsaw/MI2template/blob/master/inst/pkgdown/assets/MI2logo.jpg?raw=true" alt="MI2" height="46" title="MI2"></a>
      <a class="navbar-brand navbar-mi2" href="../index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="navbar-mi2 nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/EIX.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette_titanic.html">EIX: Titanic data </a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ModelOriented/EIX">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>EIX: Titanic data</h1>
                        <h4 class="author">Ewelina Karbowiak</h4>
            
            <h4 class="date">2018-29-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ModelOriented/EIX/blob/master/../vignettes/vignette_titanic.Rmd"><code>../vignettes/vignette_titanic.Rmd</code></a></small>
      <div class="hidden name"><code>vignette_titanic.Rmd</code></div>

    </div>

    
    
<div id="data-info" class="section level2">
<h2 class="hasAnchor">
<a href="#data-info" class="anchor"></a>Data Info</h2>
<p>This vignette shows usage of <code>EIX</code> package for titanic data. This dataset was copied from <code>stablelearner</code> package. With <code>EIX</code> package we explain XGBoost classification model concerning the survival problem. More details about <code>EIX</code> package <a href="https://modeloriented.github.io/EIX/articles/EIX.html">here</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(data.table)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">4</span>)
titanic_data&lt;-<span class="kw">data.table</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/na.fail">na.omit</a></span>(titanic_data))
knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(titanic_data))</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">gender</th>
<th align="right">age</th>
<th align="left">class</th>
<th align="left">embarked</th>
<th align="left">country</th>
<th align="right">fare</th>
<th align="right">sibsp</th>
<th align="right">parch</th>
<th align="left">survived</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">male</td>
<td align="right">42</td>
<td align="left">3rd</td>
<td align="left">Southampton</td>
<td align="left">United States</td>
<td align="right">7.11</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">no</td>
</tr>
<tr class="even">
<td align="left">male</td>
<td align="right">13</td>
<td align="left">3rd</td>
<td align="left">Southampton</td>
<td align="left">United States</td>
<td align="right">20.05</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="left">no</td>
</tr>
<tr class="odd">
<td align="left">male</td>
<td align="right">16</td>
<td align="left">3rd</td>
<td align="left">Southampton</td>
<td align="left">United States</td>
<td align="right">20.05</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">no</td>
</tr>
<tr class="even">
<td align="left">female</td>
<td align="right">39</td>
<td align="left">3rd</td>
<td align="left">Southampton</td>
<td align="left">England</td>
<td align="right">20.05</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">yes</td>
</tr>
<tr class="odd">
<td align="left">female</td>
<td align="right">16</td>
<td align="left">3rd</td>
<td align="left">Southampton</td>
<td align="left">Norway</td>
<td align="right">7.13</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">yes</td>
</tr>
<tr class="even">
<td align="left">male</td>
<td align="right">25</td>
<td align="left">3rd</td>
<td align="left">Southampton</td>
<td align="left">United States</td>
<td align="right">7.13</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">yes</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"Matrix"</span>)
sparse_matrix &lt;-<span class="st"> </span><span class="kw">sparse.model.matrix</span>(survived <span class="op">~</span><span class="st"> </span>. <span class="op">-</span><span class="st"> </span><span class="dv">1</span>,  <span class="dt">data =</span> titanic_data)</code></pre></div>
</div>
<div id="xgboost-model-creation" class="section level2">
<h2 class="hasAnchor">
<a href="#xgboost-model-creation" class="anchor"></a>Xgboost model creation</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"xgboost"</span>)
param &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">objective =</span> <span class="st">"binary:logistic"</span>, <span class="dt">max_depth =</span> <span class="dv">2</span>)
xgb_model &lt;-<span class="st"> </span><span class="kw">xgboost</span>(sparse_matrix, <span class="dt">params =</span> param, <span class="dt">label =</span> titanic_data[, <span class="st">"survived"</span>] <span class="op">==</span><span class="st"> "yes"</span>, <span class="dt">nrounds =</span> <span class="dv">50</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</code></pre></div>
</div>
<div id="model-visualization" class="section level2">
<h2 class="hasAnchor">
<a href="#model-visualization" class="anchor"></a>Model visualization</h2>
<p>First let’s plot the model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lolli&lt;-<span class="kw"><a href="../reference/lollipop.html">lollipop</a></span>(xgb_model,sparse_matrix)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(lolli, <span class="dt">threshold=</span><span class="fl">0.02</span>)</code></pre></div>
<p><img src="vignette_titanic_files/figure-html/unnamed-chunk-4-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="interactions" class="section level2">
<h2 class="hasAnchor">
<a href="#interactions" class="anchor"></a>Interactions</h2>
<p>Next we explore interactions using <code><a href="../reference/interactions.html">interactions()</a></code> functions and its plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">interactions&lt;-<span class="kw"><a href="../reference/interactions.html">interactions</a></span>(xgb_model, sparse_matrix, <span class="dt">option =</span> <span class="st">"interactions"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(interactions, <span class="dv">15</span>)</code></pre></div>
<pre><code>##                    Parent                 Child   sumGain frequency
##  1:              class3rd                  fare 45.577697         5
##  2:                 sibsp                   age 23.668270         3
##  3:          genderfemale                   age 23.227908         4
##  4:              class3rd                   age 22.997468         5
##  5:          genderfemale                  fare 13.975253         2
##  6:    countrySwitzerland                  fare 11.700150         2
##  7:                  fare classrestaurant staff  7.023322         1
##  8:                   age  countryUnited States  4.857722         1
##  9:    countrySwitzerland                   age  4.250423         2
## 10: classrestaurant staff              class3rd  4.190052         1
## 11:        classdeck crew                   age  4.165662         2
## 12:                  fare          genderfemale  4.100826         1
## 13:                   age                 sibsp  4.055897         1
## 14:                   age                  fare  4.045337         1
## 15:          genderfemale              class2nd  3.013065         1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(interactions)</code></pre></div>
<p><img src="vignette_titanic_files/figure-html/unnamed-chunk-5-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="variables-and-interactions-importance" class="section level2">
<h2 class="hasAnchor">
<a href="#variables-and-interactions-importance" class="anchor"></a>Variables’ and interactions’ importance</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">importance&lt;-<span class="kw"><a href="../reference/importance.html">importance</a></span>(xgb_model, sparse_matrix, <span class="dt">option =</span> <span class="st">"both"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(importance, <span class="dv">15</span>)</code></pre></div>
<pre><code>##                     Feature sumGain sumCover meanGain meanCover frequency
##  1:            genderfemale  840.50 5042.000   60.030   360.100        14
##  2:                class3rd  205.10 2172.000   20.510   217.200        10
##  3:          classdeck crew  115.50 2102.000   19.250   350.300         6
##  4:                     age   90.00 3870.000    5.294   227.600        17
##  5:                    fare   58.59 2996.000    3.255   166.400        18
##  6:       embarkedCherbourg   48.64  787.500   24.320   393.800         2
##  7:           class3rd:fare   45.58  682.100    9.116   136.400         5
##  8:    countryUnited States   27.46  519.500   13.730   259.800         2
##  9:   classrestaurant staff   27.41 1970.000    4.569   328.300         6
## 10:               sibsp:age   23.67  684.900    7.889   228.300         3
## 11:        genderfemale:age   23.23  849.400    5.807   212.400         4
## 12:            class3rd:age   23.00  971.200    4.599   194.200         5
## 13:                   sibsp   19.56  921.200    6.519   307.100         3
## 14:       genderfemale:fare   13.98  348.900    6.988   174.500         2
## 15: countrySwitzerland:fare   11.70    6.044    5.850     3.022         2
##     mean5Gain
##  1:   159.700
##  2:    37.050
##  3:    22.900
##  4:    12.700
##  5:     6.433
##  6:    24.320
##  7:     9.116
##  8:    13.730
##  9:     5.247
## 10:     7.889
## 11:     5.807
## 12:     4.599
## 13:     6.519
## 14:     6.988
## 15:     5.850</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(importance, <span class="dt">radar=</span><span class="ot">FALSE</span>)</code></pre></div>
<p><img src="vignette_titanic_files/figure-html/unnamed-chunk-6-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(importance)</code></pre></div>
<p><img src="vignette_titanic_files/figure-html/unnamed-chunk-7-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="explanation-of-the-single-prediction-including-interactions" class="section level2">
<h2 class="hasAnchor">
<a href="#explanation-of-the-single-prediction-including-interactions" class="anchor"></a>Explanation of the single prediction including interactions</h2>
<p>Let’s see an explanation of the prediction for an 18-year-old from England who has traveled 3rd class.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span>titanic_data[<span class="dv">27</span>,]
new_observation &lt;-<span class="st"> </span>sparse_matrix[<span class="dv">27</span>,]
wf&lt;-<span class="kw"><a href="../reference/waterfall.html">waterfall</a></span>(xgb_model, new_observation, data, <span class="dt">option =</span> <span class="st">"interactions"</span>)
wf</code></pre></div>
<pre><code>##                                 contribution
## xgboost: intercept                    -0.819
## xgboost: gender = 2                    1.714
## xgboost: class = 3                    -1.437
## xgboost: country:fare = 15:8.06       -1.011
## xgboost: country = 15                 -0.635
## xgboost: embarked = 4                  0.310
## xgboost: age:class = 18:3              0.119
## xgboost: class:age = 3:18             -0.116
## xgboost: fare = 8.06                  -0.103
## xgboost: age:country = 18:15           0.102
## xgboost: class:fare = 3:8.06           0.096
## xgboost: age = 18                     -0.094
## xgboost: age:embarked = 18:4           0.089
## xgboost: gender:class = 2:3           -0.043
## xgboost: sibsp:age = 0:18             -0.022
## xgboost: sibsp = 0                     0.021
## xgboost: gender:age = 2:18             0.020
## xgboost: fare:age = 8.06:18            0.019
## xgboost: gender:fare = 2:8.06         -0.018
## xgboost: age:sibsp = 18:0              0.010
## xgboost: parch:fare = 0:8.06           0.002
## xgboost: parch = 0                     0.001
## xgboost: prediction                   -1.794</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(wf)</code></pre></div>
<p><img src="vignette_titanic_files/figure-html/unnamed-chunk-8-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#data-info">Data Info</a></li>
      <li><a href="#xgboost-model-creation">Xgboost model creation</a></li>
      <li><a href="#model-visualization">Model visualization</a></li>
      <li><a href="#interactions">Interactions</a></li>
      <li><a href="#variables-and-interactions-importance">Variables’ and interactions’ importance</a></li>
      <li><a href="#explanation-of-the-single-prediction-including-interactions">Explanation of the single prediction including interactions</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Ewelina Karbowiak, Przemyslaw Biecek.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
