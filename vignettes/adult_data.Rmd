---
title: "xgbExplainer: adult_data"
author: "Ewelina Karbowiak"
date: "2018-05-07"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
<!-- Example of useage for adult_data from [www.archive.ics.uci.edu] (http://archive.ics.uci.edu/ml/machine-learning-databases/adult/adult.data). -->

<!-- Description of packages functionalities in -->
<!-- vignette: HR_data. -->

<!-- ```{r, echo=FALSE, warning=FALSE, message=FALSE} -->
<!-- knitr::opts_chunk$set(fig.height = 8, fig.width = 8, fig.align = "center") -->
<!-- library("data.table") -->
<!-- library("xgbExplainer") -->
<!-- library("xgboost") -->
<!-- library("Matrix") -->
<!-- library("DALEX") -->
<!-- library("ggradar") -->
<!-- library("ggrepel") -->

<!-- ``` -->

<!-- ```{r, warning=FALSE, message=FALSE} -->
<!-- adult_data<-fread('http://archive.ics.uci.edu/ml/machine-learning-databases/adult/adult.data',stringsAsFactors = TRUE ) -->
<!-- data<-adult_data -->
<!-- data=na.omit(data) -->

<!-- data[,label:=ifelse(data[,"V15"]==">50K",1,0)] -->
<!-- data<-data[,-15] -->
<!-- label<-data[,"label"]==1 -->

<!-- colnames(data)=c("age","workclass","fnlwgt","education","education_num","marital_status","occupation","relationship","race","sex","capital_gain","capital_loss","hours_per_week","native_country","label") -->


<!-- data<-data[,`:=`(workclass=as.factor(workclass),education=as.factor(education),marital_status=as.factor(marital_status),occupation=as.factor(occupation),relationship=as.factor(relationship),race=as.factor(race),sex=as.factor(sex),native_country=as.factor(native_country))] -->


<!-- sparse_matrix <- sparse.model.matrix(label~.-1, data = data) -->
<!-- colnames(data) -->
<!-- head(data) -->
<!-- str(data) -->
<!-- head(sparse_matrix) -->
<!-- xgb.train.data = xgb.DMatrix(sparse_matrix,label = label,missing = NA) -->
<!-- param <- list(objective = "binary:logistic", base_score = 0.5,max_depth=5) -->
<!-- xgb.model <-xgboost( param = param,data = xgb.train.data,nrounds = 100,verbose = FALSE) -->
<!-- head(xgb.importance(colnames(sparse_matrix),xgb.model)) -->
<!-- ``` -->


<!-- ## Model visualiations -->


<!-- ```{r, warning=FALSE, message=FALSE} -->
<!-- gainLollipop(xgb.model, sparse_matrix) -->
<!-- ``` -->


<!-- ## Interactions finding -->

<!-- We can consider interactions in two ways. In first aproach we can explore all pairs of variable, which occur in the model one above the other . This approach is not the best because we can not distinguish if pair of variables are real interaction or not. In this approach high gain of pair can be a result of high gain of down variable (child). Package has the tools to explore pairs of variables. -->

<!-- ```{r, warning=FALSE, message=FALSE} -->
<!-- knitr::kable(head(calculatePairsGainTable(xgb.model,sparse_matrix))) -->
<!-- knitr::kable(head(countPairs(xgb.model,sparse_matrix))) -->
<!-- showInteractionsPlot(xgb.model,sparse_matrix, opt="pairs") -->
<!-- ``` -->

<!-- In second approach, to find strong interactions, we can consider only these pairs of variables in which variable on the bottom has higher gain than variable on the top. -->

<!-- ```{r, warning=FALSE, message=FALSE} -->
<!-- knitr::kable(head(importanceTable(xgb.model,sparse_matrix,opt="interactions"))) -->
<!-- showInteractionsPlot(xgb.model,sparse_matrix) -->
<!-- ``` -->

<!-- ##Variables' importance -->

<!-- For single variable `xgbExplainer` gives additionally measures of variables importance: -->

<!-- * **counterRoot** - number of occurrences in the root -->
<!-- * **weightedRoot**  - mean number of occurrences in the root, which is weighted by gain -->
<!-- * **meanDepth ** - mean depth weighted by gain -->


<!-- ```{r, warning=FALSE, message=FALSE} -->
<!-- knitr::kable(head(importanceTable(xgb.model,sparse_matrix,opt="single"))) -->
<!-- ``` -->

<!-- ##Variables' and interactions importance -->

<!-- With `xgbExplainer` package we can compare importance of single variable and interactions. -->

<!-- Funtion `importancePlot` shows two measures of importance, which we can be chosen by `xlab` and `ylab` parameters. It returns three kinds of plots depending on the `opt` parametr: -->


<!--  * `opt="single"` - plot consists only single variables -->

<!--  * `opt="interactions"`- only interactions -->

<!--  * `opt="mixed"`-  plot shows importance both single variables and interactions -->


<!--  In function `importancePlot` the following measures are avaible: -->

<!-- * **sumGain** -->
<!-- * **sumCover** -->
<!-- * **mean5Gain** - mean gain from 5 occurrences of given variable with the highest gain -->
<!-- * **meanGain** -->
<!-- * **meanCover** -->
<!-- * **freqency** -->

<!-- Additionally for `opt="single"`: -->

<!-- * **meanDepth** (weighted by variables gain) -->
<!-- * **counterRoots** -->
<!-- * **weightedRoot** (weighted by variables gain) -->

<!-- ```{r, warning=FALSE, message=FALSE} -->
<!-- knitr::kable(head(importanceTable(xgb.model, sparse_matrix))) -->
<!-- importancePlot(xgb.model, sparse_matrix) -->
<!-- ``` -->

<!-- The function `importanceRadarPlot` allows us to compare different measures of variables and interteranctions importance on the radar plot from `ggradar` package. Similar to the funtion `importancePlot` it is posible to ganerate this plot in three ways depending on the parametr `opt`. -->

<!-- ```{r, warning=FALSE, message=FALSE} -->
<!-- importanceRadarPlot(xgb.model,sparse_matrix,top=10, trees=NULL, opt="mixed") -->
<!-- ``` -->

<!-- ##Explanation of one prediction including interactions -->

<!-- ```{r, warning=FALSE, message=FALSE} -->

<!-- ``` -->
